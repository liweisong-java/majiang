<view class="balance-history">
  <view class="history-header">
    <text class="history-title">ç§¯åˆ†å˜åŠ¨è®°å½•</text>
    <text class="history-count">å…± {{processedHistory.length}} æ¡</text>
  </view>

  <view class="history-list" wx:if="{{processedHistory.length > 0}}">
    <view
      class="history-item {{item.isRelatedToMe ? 'related-to-me' : ''}}"
      wx:for="{{processedHistory}}"
      wx:key="index"
      data-index="{{index}}"
      bindtap="toggleExpand"
    >
      <view class="item-main">
        <view class="item-left">
          <text class="item-time">{{item.formattedTime}}</text>
          <text class="item-desc">{{item.description}}</text>
        </view>
        <view class="item-right">
          <text class="item-amount {{item.fromOpenid === myOpenid ? 'negative' : item.toOpenid === myOpenid ? 'positive' : ''}}">
            {{item.fromOpenid === myOpenid ? '-' : item.toOpenid === myOpenid ? '+' : ''}}{{item.amount}}
          </text>
          <text class="expand-icon">{{expandedIndex === index ? 'â–²' : 'â–¼'}}</text>
        </view>
      </view>

      <!-- å±•å¼€è¯¦æƒ… -->
      <view class="item-detail" wx:if="{{expandedIndex === index}}">
        <view class="detail-row">
          <text class="detail-label">è½¬å‡ºè€…ï¼š</text>
          <text class="detail-value">{{item.fromNickname}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">æ¥æ”¶è€…ï¼š</text>
          <text class="detail-value">{{item.toNickname}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">é‡‘é¢ï¼š</text>
          <text class="detail-value">{{item.amount}}</text>
        </view>
        <view class="detail-row" wx:if="{{item.isRelatedToMe}}">
          <text class="detail-label">æˆ‘çš„ç§¯åˆ†ï¼š</text>
          <text class="detail-value {{item.balances[myOpenid] >= 0 ? 'positive' : 'negative'}}">
            {{item.myBalanceChange}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <view class="empty-state" wx:else>
    <text class="empty-icon">ğŸ“</text>
    <text class="empty-text">è¿˜æ²¡æœ‰ç§¯åˆ†å˜åŠ¨è®°å½•</text>
  </view>
</view>
