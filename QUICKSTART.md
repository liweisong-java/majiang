# 快速启动指南

## 当前状态

✅ **代码编译成功** - 所有语法错误已修复
⚠️ **云函数未部署** - 使用临时 Mock 数据（可正常测试功能）

## 快速开始（无需云函数）

项目已配置为**开发模式**，可以在不部署云函数的情况下测试所有功能。

### 1. 打开项目

在微信开发者工具中打开此项目。

### 2. 编译运行

点击"编译"按钮，应该能正常运行。

### 3. 功能测试

可以测试的功能：
- ✅ 创建房间（使用前端逻辑）
- ✅ 加入房间（输入邀请码）
- ✅ 添加记录
- ✅ 查看统计
- ✅ 牌友列表

### 4. 临时限制

由于使用 Mock OpenID：
- 每次重新编译会生成新的用户
- 无法跨设备同步
- 刷新页面后可能需要重新创建数据

## 完整部署（生产环境）

如果要部署到生产环境，需要完成以下步骤：

### 步骤 1: 配置云开发环境

1. **开通云开发**
   - 在开发者工具中点击"云开发"按钮
   - 开通云开发并创建环境
   - 记录环境 ID（格式：`xxx-xxx`）

2. **配置环境 ID**（可选）

   在 `miniprogram/app.ts` 中：
   ```typescript
   await cloudService.init('your-env-id');
   ```

### 步骤 2: 创建数据库集合

按照 `DATABASE.md` 文档，在云开发控制台创建 5 个集合：
1. users
2. rooms
3. game_records
4. friends
5. personal_records

**权限配置**: 参考 DATABASE.md

### 步骤 3: 部署云函数

1. **确认配置**

   `project.config.json` 已包含：
   ```json
   "cloudfunctionRoot": "cloudfunctions/"
   ```

2. **右键部署**
   ```
   cloudfunctions/
   ├── login/          ← 右键 → 上传并部署：云端安装依赖
   ├── createRoom/     ← 右键 → 上传并部署：云端安装依赖
   └── joinRoom/       ← 右键 → 上传并部署：云端安装依赖
   ```

3. **等待部署完成**（每个约 30-60 秒）

### 步骤 4: 移除临时代码（可选）

部署云函数后，可以移除 `cloud.service.ts` 中的临时 Mock 逻辑：

```typescript
public async login(): Promise<{ openid: string }> {
  try {
    const result = await this.callFunction('login', {});
    if (result.openid) {
      return { openid: result.openid };
    }
    throw new Error('获取 openid 失败');
  } catch (error) {
    console.error('登录失败:', error);
    throw error;
  }
}
```

### 步骤 5: 测试验证

1. 重新编译小程序
2. 应该能正常获取真实 openid
3. 测试完整业务流程

## 开发模式 vs 生产模式

### 开发模式（当前）
- ✅ 无需云函数，快速测试
- ✅ 本地数据库操作
- ⚠️ 使用 Mock OpenID
- ⚠️ 数据不持久

### 生产模式
- ✅ 真实云开发环境
- ✅ 真实用户身份
- ✅ 数据持久化
- ✅ 多设备同步
- 需要部署云函数和数据库

## 建议

1. **先在开发模式下测试功能**
   - 熟悉业务流程
   - 验证 UI 和交互
   - 发现并修复 bug

2. **功能稳定后再部署云开发**
   - 一次性创建所有数据库集合
   - 批量部署所有云函数
   - 配置权限和索引

3. **生产环境测试**
   - 多设备测试同步功能
   - 测试真实用户数据
   - 性能和稳定性测试

## 当前可用功能

即使不部署云函数，你也可以：

✅ 浏览所有页面
✅ 测试 UI 交互
✅ 验证表单验证
✅ 查看样式效果
✅ 测试页面跳转
✅ 体验完整流程（使用临时数据）

**现在就可以开始使用了！** 🎉
